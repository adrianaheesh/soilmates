<h2><%= @store.name %></h2>
<p>
  <%= cl_image_tag(@store.banner.key, cloud_name: 'adriana-developer') if @store.banner.attached? %>
</p>

<p>
  <%= @store.description %>
</p>

<% if @store_average_rating >= 0 %>
  <p>
    <strong>Average rating:</strong>
    <%= @store_average_rating%>/5
    from <%= pluralize(@store.store_reviews.count, "review") %>.
  </p>
<% end %>

<h4>Products:</h4>
<% if @store.products.count == 0 %>
  <p>This store doesn't have any products.</p>
<% end %>
<br>
<div class="card-container">
  <% @store.products.each do |product| %>
      <div class="card" style="width: 18rem;">
        <%= cl_image_tag(product.image.key, crop: :scale, cloud_name: 'adriana-developer', class: "card-img-top") if product.image.attached? %>
        <div class="card-body">
          <h5 class="card-title"><%= product.name %></h5>
          <h6 class="card-subtitle mb-2 text-muted"><%= product.availability ? "In stock" : "Sold out" %></h6>
          <%= link_to_if product.availability, 'Shop', product %>
          <% if user_signed_in? && @user_owns_a_store && current_user.store.id == @store.id %>
            <%= link_to 'Edit', edit_product_path(product) %>
          <% end %>
        </div>
      </div>
  <% end %>
</div>

<br><br>

<% @store_reviews.each do |review| %>
  <div class="review-card">
    <p>Rating: <%= review.rating %></p>
    <p><%= review.comment %></p>
  </div>
  <br>
  <% end %>
<%= will_paginate @store_reviews %>

<% if user_signed_in? && current_user.store.id == @store.id %>
  <%= link_to 'Edit your store', edit_store_path(@store) %>
<% end %>

<% if user_signed_in? && current_user.store.id != @store.id %>
<hr>
<p>
  Leave a review:
</p>
  <%= simple_form_for [@store, @store_review], local: true do |f| %> 
    <%= f.error_notification %>
    <%= f.input :rating, as: :integer, collection: ["1","2","3","4","5"], as: :radio_buttons, error: "You must provide a rating" %>
    <%= f.input :comment, label: "Comments:", error: "You must provide a comment" %>
    <%= f.button :submit, "Leave your review" %>
  <% end %>
<% end %>
